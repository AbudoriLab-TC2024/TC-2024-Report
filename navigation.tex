\section{ナビゲーション}
ROS 2では、自己位置推定、経路計画、経路追従の手法が詰め合わせとなっているパッケージとしてNavigation2がある。
このNavigation2パッケージを利用することで、それぞれのタスクを処理するアルゴリズムを利用できる。
今回は3次元地図で自己位置推定を行なっているので、経路計画と経路追従のアルゴリズムを利用した。

\subsection{経路計画}
経路計画は現在の位置座標からゴールとなる座標までの区間でロボットが到達可能な経路を計算するタスクである。
走行する環境地図


今回は3次元地図を利用しているが、空中を飛ぶドローンではなく地上を走るロボットであるため、2次元空間で経路計画を行う。
環境地図と自己位置を入力すれば、指定したゴール座標までの経路を出力してくれる。
計算アルゴリズムの手法が複数用意されている。
各手法がPluginとして実装されており、コンフィグファイルでPlugin名を変更するだけで反映される。
つくばチャレンジ2024では、3DMapを利用して自己位置推定を行なった。
Navigation2にはMapを入力せず、３DMapからの自己位置推定のX,Y,Yawの値をそのまま利用するだけで２Dに転写した。
Navigaiton2には作成したObstacleToScanから2DLiDARを模擬したscanトピックを入力した。
これで２DMapはないが、ロボット周辺の障害物マップは作成される。
これで、ロボットから２〜１０m程度の距離にゴールを指定することで短距離の経路を計算してくれる。
この短距離で達成できるゴールを数メートルおきに、完走のゴールまで配置しつづける。
近くのゴールが達成できれば、次のゴールを設定する処理を自動化した。
これがPenguinNav。
penguinnavはお願いします。
SmacPlanner。
経路計画方法はSmacPlannerを利用した。
SmacPlannerはNavigation2のPluginに実装されているため、ConfigファイルでSmacPlannerを選択するだけで利用できる。
SmacPlannerはロボットの形状を考慮した衝突判定をしてくれる。
したがって、自ロボットの投影面積であるポリゴンを指定するだけで、無茶な経路は選ばれなくなる。
また、最小回転半径も指定できるため、なめらかな円弧で走行経路を利用できる。
これにより、障害物ギリギリまで近づいて急に避ける行動を抑えることができた。

\subsection{経路追従}
前節のSmacPlannerで計算された経路をロボットがどのように再現するか計算するアルゴリズムを経路追従アルゴリズムという
Navigation2では、さまざまな経路追従アルゴリズムを利用できる
つくばチャレンジ2024では、DWBをつかった
DWBはロボットが再現可能な速度や加速度の範囲の中で一番良い速度を選択する
最高速度と最低速度と加速度を設定できる
クローラの制御の場合、抵抗が非常に大きく初動に大きなエネルギーを必要とする
最低速度を速く設定し、すぐに停止できるように減速加速度を大きくなるように設定した。