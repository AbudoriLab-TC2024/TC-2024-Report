\section{ナビゲーション}
ROS 2では、自己位置推定、経路計画、経路追従の手法が詰め合わせとなっているパッケージとしてNavigation2\cite{macenski2020marathon2}がある。
このNavigation2パッケージを利用することで、それぞれのタスクを処理するアルゴリズムを利用できる。
今回は3次元地図で自己位置推定を行なっているので、経路計画と経路追従のアルゴリズムを利用した。

\subsection{経路計画}
経路計画は現在の位置座標からゴールとなる座標までの区間でロボットが到達可能な経路を計算するタスクである。
経路計画は2次元の占有格子地図上で計算した。
ロボットに持たせている3D地図は、単純に地図上の座標を知ることのみで利用している。
この3次元の自己位置座標から、2次元空間で利用するために、X,Y,Yawの値をそのままコピーするだけで2Dに転写した。

経路計画を行う時は、いきなり最終目的地への経路を計画するのではなく、
数メートルおきに小さなゴールを用意し、到達したらまた次の小さなゴールに向かって経路計画を行う。
この小さなゴールをWaypointと呼ぶ。

Waypointをロボットの状況に合わせて通知するPenguin\_navパッケージ\cite{Penguin}を作成した。
Penguin\_navは...

Penguin\_navから受け取ったWaypointまでの経路を計算する。
Navigation2では、さまざまな経路計画アルゴリズムを利用することができる。
今回はSmacPlanner\cite{macenski2024smac}を利用した。
SmacPlannerはNavigation2のPluginに実装されているため、ConfigファイルでSmacPlannerを選択するだけで利用できる。

SmacPlannerはロボットの形状を考慮した衝突判定をしてくれる。
したがって、自ロボットの投影面積であるポリゴンを指定するだけで、無茶な経路は選ばれなくなる。
また、最小回転半径も指定できるため、なめらかな円弧で走行経路を利用できる。
クローラは非常に抵抗が大きく、その場旋回がとても大変な駆動方法である。
そのため、最小半径を0.4mに設定した。
これにより、走り出しのぎこちなさを抑えつつも、必要に応じて急旋回もできる曲率となった。

\subsection{経路追従}
前節のSmacPlannerで計算された経路をロボットがどのように再現するか計算するアルゴリズムを経路追従アルゴリズムという。
Navigation2では、経路追従アルゴリズムもすでに実装されている手法から選んで使用することができる。
今回は、DWBを利用した。

DWBはロボットが再現可能な速度や加速度の範囲の中で一番良い速度を選択する。
最高速度と最低速度と加速度を設定できる。
クローラの制御の場合、抵抗が非常に大きく初動に大きなエネルギーを必要とする
最低速度を速く設定し、すぐに停止できるように減速加速度を大きくなるように設定した。

経路追従アルゴリズムでも障害物に衝突しない速度ベクトルを計算するが、それでもそのベクトルのまま走行した時に衝突しないかチェックするCollision\_monitorがある。
Collision\_monitorは....

以上のアルゴリズムによって、ロボットのモータをどのように駆動するかを計算することができた。
この速度ベクトルの通り、モータを回すことでロボットをより目標地点に近づくように走行することができる。
センシング→自己位置推定→障害物検知→経路計画→経路追従→移動→センシング…
とこの一連の操作を繰り返していくことで、Waypointまでの移動を達成する。
最後のWaypointは到達したいゴールとなり、長距離の自律走行を実現することができる。