# アーギュメント：3DLiDARの自律走行環境は揃っている
# アカデミックな価値：つくちゃれレポートを読んでも初学者は自律走行できない

# はじめに
* つくばチャレンジは2024年のロボット大賞に選出された
   * つくばチャレンジは18年間、課題や取り組みを変えながら日本のロボット技術の進歩に大きく貢献してきた
   * さまざまな研究者に大体的に実験できる環境を提供しつづけロボットの技術を成長させてきた
* 完走しているチームの技術力は非常に高い
* 初めて参加するチームや個人で参加するチームとは技術的な差が大きい
   * 初参加から完走するまでの道のりは遠い
   * その要因は以下の点であると感じた
      * 完走しているチームの多くは高価な3DLiDARを搭載している
      * ROS 2を使用した3Dナビゲーションのノウハウがウェブ上にあまり公開されていない
      * つくばチャレンジレポートは昨年のレポートの差分が書かれていることが多い
      * つくばチャレンジレポートは特定の課題の解法が書かれていることが多い
      * つくばチャレンジレポートは過去のレポートがオープンになっていないため、引用先が見られない
   * 以上の点から、初学者や新規参入者に対して敷居が高いように感じた
* 同時に、完走するために必要なことは以下のように感じた
   * 屋外の自律走行には初学者ほど3DLiDARがあった方がよい
   * 複雑なシステムを運用するには、質の良いハードウェアが必要である
   * OSSを駆使すればある程度まではロボットを動作させることができる
   * OSSを利用するだけでは完走には至らない
* AbudoriLab.チームでは、本走行では確認走行区間をクリアできなかった
   * 他のロボットが通路を塞いだため新ルートを作れなかった
* 決められたルートに何も障害物がない状態であれば、もっと走行することができた
* 決められたルートを走行することだけであれば、自己位置を喪失することなく、障害物も発見し走行することができた
* ゼロからつくばチャレンジに参加する人に必要なことがわかるレポートにしたい
* AbudoriLab.が用意したロボットやソフトウェア構成を紹介する
 
# システムアーキテクチャ
* 自律走行システムのハードウェア（吉田）
   * 自律走行ロボットにはさまざまな部品が必要である
   * 具体的は以下の通り
      * センサ
         * 自己位置推定LiDAR
            * 高い位置に設置
            * 囲まれても遠くの建物が映るように
         * 障害物検知LiDAR
            * 地面がわざと映るようにななめ設置
            * LiDARから地面にある障害物の最短距離が0.3mで検知できるように設置
         * ロボットシャーシ
            * クローラロボット開発プラットフォームを採用した
         * 電源
            * 各デバイスが動作するようにバッテリーから変圧して配電している
   * ロボットハードウェアの構成
      * 図
   * 分解して持ち運べる部品構成
      * 大きく分けて以下の部品で分解できる
         * ロボットシャーシ
         * PC
         * 筐体
         * センサ
      * 他に工夫した点があれば
      * 図があれば
   * ロボットの走行状態の表示機能（村上）（書きたければ）
      * LEDによる意思表示
      * 他に工夫したことがあれば
      * 図があれば

* 自律走行システムのソフトウェア
   * ロボットを走行させるためのソフトウェア構成は以下の通りである
      * 地図作成
         * ロボットの活動範囲内は既知の場所
         * 現実の場所とリンクした地図をロボットに持たせる
         * 自己位置推定に使用する  
      * 自己位置推定
         * 現在の位置がロボットが持っている地図のどこに位置するのか推定する
         * 現在位置が分かれば、目的までの向かう経路を計算することができる
      * 障害物認識
         * 自己位置推定ができても、実際には障害物があってたどり着かないことがほとんどだ
         * 向かいたい場所までの経路上に障害物がどのようにあるのか反映させる
      * 経路計画
         * ロボットは地図をもっているので目的地点と現在位置があれば2点間の経路を計算できる
         * このとき、環境上にある障害物も加味し、障害物に衝突しない経路を計算する
         * 実際の自律走行では、数メートルおきに達成地点を設置し、細かく経路計画を実施する
      * 経路追従
         * 計算した経路にロボットを追従させる
         * 障害物を回避しながら、柔軟に経路通りにロボットを制御させる必要がある 
   * 次の章から、それぞれの方法で具体的に使用したソフトウェアを紹介する

# 地図作成
* 現代の自律走行の大半は、ロボットの行動範囲の環境地図を作成する。
* 作成した環境地図をロボットが持つことにより、既知の環境内で自由に行動することを目指す
* ROS 2標準のNavigation2の標準アルゴリズムも含め環境地図は2Dのものが多い
* 2D地図は室内など水平であり障害物が単純な環境であれば、とてもよく動作する
* しかし、屋外や広大な環境だと以下のような点でうまくいないことがある
   * 設置した2DLiDARの設置高さによっては検知できない障害物が多く、無視できないことがある
   * 上り坂など、本来障害物でないものも障害物として認識することがある
   * 2D地図で表現しきれない障害物が重要な物体であった場合、精度が大幅に悪化する
   * 自動車が止まったりするなど環境の変化があると大きく悪影響を受けることがある
* このつくばチャレンジ2024では、3Dの地図を作成し、上記のポイントで複雑な環境でもうまく地図表現をした
* 回転式3DLiDARは非常に高価であるが、つくばチャレンジでは、無料貸与がある
   * つくばチャレンジ2024では、株式会社アルゴさまより無料で貸与いただいた
   * もっていない人でも3DLiDARに挑戦することができる
   * ぜひやっていただきたい
* 地図作成には、回転式3DLiDARで、GLIM（引用）を用いて作成した
* 作成したつくばチャレンジの走行範囲全域の地図は図の通りである
   * 図
* 環境構築をした後、全周のルートを走行させた時のロボットの回転式3DLiDARのセンサデータを記録したROSBAGファイルを再生するだけで3D地図が作成できてしまった
* 設定にチューニングとしては以下の点である
   * あああ
   * いいい
   * ううう
* AAAの点では、あああパラメータが効く
* BBBの点では、いいいパラメータが効く
* CCCの点では、うううパラメータが効く
* XXXという点に注意してパラメータチューニングするとよい
* 最後に、オフライン地図修正ツールが同梱されているのでこれで地図を微修正する
* ループクローズがうまくハマるように指定する
* つくばチャレンジ全域で自己位置推定ができる地図ができた
* 3D地図はhttps://google-drive で公開しているので、来年同じ構成で使用したい方は使うと良い。

# 自己位置推定
* 前章で作成した3D地図に対して、ロボットの自己位置を表現する
* 3D地図で自己位置推定することで、2D地図よりも以下の点で優れていると考えたため採用した
  * トラックのような大きな障害物がある場合でも自己位置が破綻しない
  * 2D地図の場合はバンが止まっている場所に近づいた時、位置が飛んでしまった
  * 2D地図の場合はロボットの周辺に人だかりがあるとマッチングできない
  * 2D地図の場合は坂道のように地面が2DLiDARに映る場合、位置が飛んでしまった
* 後述のNavigationでは、2Dを利用する
  * 地面を走行するロボットであるため、2Dの姿勢で十分
  * 3Dで自己位置推定して、そのうちX,Y,Yawだけを抽出して利用する
* 自己位置推定手法としては、OSSのLidar_localization_ros2を利用した
  * 前章で作成した3D地図をpcdに変換して読み込んだ
  * 地図はコンフィグファイルに絶対パスを書き込むだけ読み込まれる
  * LiDARを起動した状態で自己位置推定アルゴリズムを起動する
  * 起動した後に初期位置を与える
  * コンフィグで初期設定を与えることもできる
  * 初期姿勢と地図のマッチングが成功すると常にLiDARスキャンマッチをつづけて自己位置を更新し続ける
* 設定にチューニングとしては以下の点である
  * あああ
  * いいい
  * ううう
  * AAAの点では、あああパラメータが効く
  * BBBの点では、いいいパラメータが効く
  * CCCの点では、うううパラメータが効く
  * XXXという点に注意してパラメータチューニングするとよい
* 以下の点で自己位置が破綻することがある
  * あああ
  * いいい
  * ううう
* オドメトリをオンにすることでふっとびを抑えることができた
* IMUはチューニング不足で破綻してしまった
* 結果的にXXXに注意すると良い

# 障害物認識
* 自己位置とゴールが分かればロボットが進むべき経路を計算できる
* ただし、これだけでは現実にある衝突してはいけない障害物を考慮していない
* LiDARなどのセンサを使って障害物を認識し、それを地図に反映させることで障害物を考慮した経路を計算できる
* 2DLiDARを使うと坂道など地面が写ってしまう
* 2DLiDARを使うと机のような物体は脚しか映らない
* 3DLiDARを使うことで
# 経路計画（青木）
* Penguin_navについて、他章を参考にレポートをお願いします。
# 経路追従
* local_plannerについて
* Pure Persuitはダメ
* DWBをつかった
* XXXを優先したチューニングを行った
# 本走行（考察）
# 結論
# 謝辞
